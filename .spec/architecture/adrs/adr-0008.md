# ADR-0008: Use JSON for Event Serialization in MVP1

## Status
Accepted

## Context
Event-driven communication requires serialization format for Kafka messages. Options include:
1. **JSON**: Human-readable, simple, no schema registry required
2. **AVRO**: Binary, compact, schema evolution with registry (Confluent Schema Registry)
3. **Protocol Buffers**: Binary, compact, schema-first (Google's protobuf)

MVP1 priorities focus on **rapid development and debugging**. AVRO provides:
- Schema evolution (backward/forward compatibility)
- Compact binary format (reduced network traffic)
- Schema registry (centralized schema management)

However, AVRO adds:
- Schema Registry infrastructure (deploy, configure, monitor)
- Schema evolution governance (who approves schema changes?)
- Debugging complexity (binary format requires deserialization tools)

## Decision
**Use JSON for Event Serialization in MVP1, migrate to AVRO in MVP2**:

**MVP1 Approach**:
- Events serialized as **JSON strings** in Kafka messages
- Event schema defined in code (POJOs with Jackson annotations)
- No schema registry required
- Schema evolution handled via **additive-only** changes (never remove fields, add with defaults)

**Example Event (JSON)**:
```json
{
  "eventId": "evt-uuid",
  "eventType": "OrderCreated",
  "timestamp": "2025-11-25T10:30:00Z",
  "correlationId": "corr-uuid",
  "payload": {
    "orderId": "ORD-001",
    "customerId": "CUST-001",
    "totalAmount": 109.97
  }
}
```

**MVP2 Migration**:
- Deploy Confluent Schema Registry
- Define AVRO schemas (`.avsc` files) for all events
- Update producers/consumers to use AVRO serializers/deserializers
- Implement schema evolution rules (backward compatibility required)
- Feature flag to toggle JSON → AVRO (gradual rollout)

## Consequences

**Positive**:
- **Simplicity**: No schema registry infrastructure in MVP1
- **Debuggability**: Human-readable JSON in Kafka topic inspection tools
- **Faster Development**: No schema compilation step, direct POJO mapping
- **Lower Ops Burden**: Fewer components to deploy and monitor

**Negative**:
- **No Schema Validation**: Producers can publish invalid events (mitigated by unit tests)
- **Larger Payload**: JSON larger than AVRO binary (acceptable for MVP1 load)
- **Risky Schema Evolution**: Breaking changes possible if additive-only rule violated
- **Technical Debt**: AVRO migration required for production scale

**Risks**:
- Developer accidentally removes field from event → breaking change → consumer crashes
- JSON payload size impacts Kafka throughput at high load (deferred to MVP2 performance testing)

**Follow-ups**:
- Document additive-only schema evolution rule in team wiki
- Implement contract tests (Pact) to catch breaking changes
- Plan AVRO migration spike during MVP1 (estimate effort)
- Create separate ADR for schema registry technology selection (Confluent vs Apicurio) before MVP2
