# ADR-0009: Defer Security Integration to MVP2

## Status
Accepted

## Context
Production systems require:
- **Authentication**: Verify user/client identity (OAuth2, OIDC, JWT)
- **Authorization**: Enforce access control (RBAC, permissions)
- **Encryption**: Protect data at rest and in transit (TLS, database encryption)
- **Audit Logging**: Track sensitive operations for compliance

MVP1 priorities focus on **functional workflow validation** (order processing, SAGA, events). Security integration adds:
- OAuth2 provider setup (Keycloak, Auth0, AWS Cognito)
- JWT validation middleware in each service
- Role/permission management (database schema, admin UI)
- TLS certificate management (cert-manager, Let's Encrypt)
- Compliance requirements (PCI-DSS for payments, GDPR for customer data)

Deferring security allows faster MVP1 delivery while validating core architecture in trusted internal environment.

## Decision
**Defer Security Integration to MVP2, with minimum baseline for MVP1**:

**MVP1 Approach (Internal Testing Only)**:
- **No Authentication**: REST APIs accept requests without tokens
- **No Authorization**: All endpoints publicly accessible
- **TLS for Kafka**: Enabled (minimal overhead, prevents plaintext event exposure)
- **Database Encryption**: Not enabled (local dev/staging environments only)
- **Environment Restriction**: Deploy MVP1 **only in internal/dev environments**, never production

**MVP2 Security Requirements**:
- **API Gateway**: Enforce OAuth2/OIDC authentication at gateway
- **JWT Tokens**: Issued by identity provider (Keycloak), validated by services
- **Service-to-Service**: mTLS for inter-service communication
- **Database Encryption**: Enable encryption at rest (PostgreSQL, MongoDB Atlas)
- **Audit Logging**: Log all API calls with user identity, sensitive data access
- **Compliance**: PCI-DSS audit for payment data, GDPR compliance for customer data

## Consequences

**Positive**:
- **Faster MVP1 Delivery**: Avoid 2-3 weeks of security infrastructure work
- **Simplified Testing**: No token management, direct API access
- **Focus on SAGA**: Validate core business logic without auth complexity
- **Deferred Decisions**: Security technology choice based on actual requirements in MVP2

**Negative**:
- **Not Production-Ready**: MVP1 cannot be exposed to external users/internet
- **Compliance Risk**: Delayed PCI-DSS/GDPR compliance (mitigated by internal-only deployment)
- **Rework Risk**: Services may need refactoring for JWT claim extraction, RBAC enforcement

**Risks**:
- **Accidental Exposure**: MVP1 deployed to production environment → data breach (mitigate with strict environment controls)
- **Security as Afterthought**: Team underestimates MVP2 security effort → schedule slips

**Follow-ups**:
- **Mandatory**: Mark all MVP1 environments as **NON-PRODUCTION** in deployment configs
- Implement network isolation (Kubernetes NetworkPolicies) to prevent external access
- Spike OAuth2 provider (Keycloak vs Auth0) during MVP1
- Design service interfaces with future JWT claims in mind (e.g., `customerId` from token)
- Create separate ADRs for:
  - OAuth2 provider selection
  - mTLS implementation approach
  - Audit logging strategy
- Schedule security audit before MVP2 production deployment
