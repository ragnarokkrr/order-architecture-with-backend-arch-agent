# ADR-0006: Defer Payment Gateway Integration to MVP2

## Status
Accepted

## Context
Production payment processing requires integration with external gateways (Stripe, PayPal, etc.) for:
- Credit card tokenization and PCI compliance
- Payment authorization and capture
- Fraud detection and 3D Secure

MVP1 goals prioritize **functional order processing workflow** and SAGA pattern validation. Payment gateway integration adds:
- Complex error handling (network failures, gateway timeouts, retry logic)
- PCI compliance requirements (secure credential storage, audit logs)
- Testing complexity (sandbox accounts, webhook handling)

Deferring gateway integration allows faster MVP1 delivery while validating core architecture.

## Decision
**Defer Payment Gateway Integration to MVP2**:

**MVP1 Approach**:
- Payment Service **records transaction in local MongoDB** with hardcoded success logic
- Payment processing simulates gateway call with configurable success/failure rate (for testing)
- Payment status stored as `SUCCESS` or `FAILED` based on simple business rules (e.g., amount < $10000)

**MVP2 Migration**:
- Implement payment gateway adapter (Stripe API) behind existing Payment Service port
- Replace local transaction logic with gateway API calls (tokenize, authorize, capture)
- Add webhook handlers for asynchronous payment confirmations
- Implement PCI-compliant credential storage (vault)

**Code Isolation**:
- Payment processing logic abstracted behind `PaymentProcessor` interface
- MVP1: `LocalPaymentProcessor` implementation
- MVP2: `StripePaymentProcessor` implementation (swap via Spring profile or feature flag)

## Consequences

**Positive**:
- **Faster MVP1 Delivery**: Avoid 2-3 weeks of gateway integration work
- **Simplified Testing**: No dependency on external sandbox environments
- **Focus on SAGA**: Validate distributed transaction pattern without gateway complexity
- **Architecture Validation**: Hexagonal pattern in Order Service proves adapter swapping works

**Negative**:
- **Not Production-Ready**: MVP1 cannot process real payments (internal testing only)
- **Deferred Complexity**: Gateway integration risks surface only in MVP2
- **Rework Risk**: Payment Service schema may need changes for gateway-specific fields

**Risks**:
- Payment Service interface designed without gateway constraints → requires refactoring in MVP2
- Team underestimates gateway integration effort → MVP2 schedule slips

**Follow-ups**:
- Spike gateway API (Stripe) during MVP1 to validate interface design
- Design Payment Service schema with gateway fields (payment_method, external_transaction_id) even if unused in MVP1
- Create separate ADR for gateway technology selection before MVP2
